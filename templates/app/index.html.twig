{% extends 'base.html.twig' %}

{% block title %}{{ parent() }} - Test Technique{% endblock %}

{% block body %}

	{% for point in pointsOfInterest %}
		{% include 'app/_pointOfInterest.html.twig' with {'point': point} only %}
	{% else %}
		Aucun point d'intérêt n'est enregistré.
	{% endfor %}

	{{ form(newPointForm, {'attr': {'id': 'new_point_form'}}) }}

{% endblock %}

{% block javascripts %}
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="   crossorigin="anonymous"></script>
	<script type="text/javascript">
		$('body').on('submit', '#new_point_form', function (e) {
	        e.preventDefault();
	        $.ajax({
	            type: $(this).attr('method'),
	            url:  $(this).attr('action'),
	            data: $(this).serialize()
	        })
	        .done(function (data) {
	        	var name = $('#point_name').val();
	        	var address = $('#point_address').val();
	        	var latitude = $('#point_latitude').val();
	        	var longitude = $('#point_longitude').val();
	            addPointToMap(name, address, latitude, longitude);
	            $('#new_point_form input').val('');
	        })
	        .fail(function (jqXHR, textStatus, errorThrown) {
	            if (typeof jqXHR.responseJSON !== 'undefined') {
	                if (jqXHR.responseJSON.hasOwnProperty('form')) {
	                    $('#form_body').html(jqXHR.responseJSON.form);
	                }
	                $('.form_error').html(jqXHR.responseJSON.message);
	            } else {
	                alert(errorThrown);
	            }
	        });
	    });

	    function addPointToMap(name, address, latitude, longitude) {
	    	console.log('TODO: addPointToMap');
	    }
	</script>
{% endblock %}